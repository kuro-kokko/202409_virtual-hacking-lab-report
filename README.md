# 202409_virtual-hacking-lab-report

## はじめに

このレポートはセキュリティ学習として仮想環境でハッキングを行い、その結果得られた知見を纏めたものです。

## 実施内容

下記書籍を参考に、個人所有PC内のOracle VirtualBox上のマシンで攻撃を行った。  
[IPUSIRON(2024).『ハッキング・ラボのつくりかた 完全版 仮想環境におけるハッカー体験学習』.翔泳社](https://www.shoeisha.co.jp/book/detail/9784798185996)

今回は[ParrotOS](https://www.parrotsec.org/)を用い、下記の3ケースを実施した。

### #1 攻撃対象マシン : [Potato](https://www.vulnhub.com/entry/potato-1%2C529/)

1. `netdiscover`で対象マシンのIPアドレスを特定
1. `nmap`コマンドでポートスキャンを行う
1. AnonimousFTPのログインが許可されているポート2112からファイルをダウンロード
1. HTTPサービスにアクセスし、Gobusterでアクセス可能なディレクトリを調べる
1. 脆弱な認証ソースコードに対してHTTPリクエストを改変して認証を通過
1. ディレクトリトラバーサル攻撃を行いパスワードファイルを入手
1. SSHアクセス・他ユーザーのディレクトリにアクセス
1. 利用可能なコマンド等を調査・利用してroot権限を奪取

### #2 攻撃対象マシン : [DC-1](https://www.vulnhub.com/entry/dc-1%2C292/)

1. `fping`で対象マシンのIPアドレスを特定
1. `nmap`コマンドでポートスキャンを行う
1. ブラウザでHTTPサービスにアクセスし、`robots.txt`を確認
1. `droopescan`で対象マシンをスキャンしDrupalのバージョンを推測
1. Expilotで該当バージョンの脆弱性情報を探す(今回はDrupalgeddonを狙う)
1. MetaspilotでDrupalgeddonモジュールを実行
1. shellを奪取しシステム内を探索
1. `find`コマンドを利用してroot権限を奪取

### #3 攻撃対象マシン : [DC-2](https://www.vulnhub.com/entry/dc-2%2C311/)

1. Pingスイープし、`nmap`コマンドでポートスキャンを行う
1. `/etc/hosts`ファイルを編集してHTTPアクセス(リダイレクト制御)
1. Gobusterでアクセス可能なディレクトリを調べる
1. ディレクトリから認証ページである可能性が高いURLを推測してアクセス
1. ユーザー名の存在検証を実施
1. `wig`で情報収集後、`nmap`でWordPressのユーザーを列挙する
1. CeWLでパスワード候補リストを作成する
1. パスワードクラッカーでパスワードを解読
1. 判明した認証情報を利用してSSHログイン
1. ログイン可能なユーザーで実行出来るコマンドを調査
1. `su`コマンドでユーザー切替、`sudo`コマンドの設定を調べる
1. `sudo git -p help config`を叩きroot権限を奪取

## 考えられる対策

### 侵入させない

- ファイアウォールで不要なポートを閉じる
- 多要素認証を実装する
- アクセス制御リストを適用する

### 侵入されても被害を抑える

- 重要なシステムを分離する
- データやパスワードを暗号化する

### その他対策

- OSやソフトウェアのセキュリティアップデートを適用する
- システムに携わる人向けにセキュリティ教育を実施する
- ログ監視で不審なアクセスを検出する

## 総括

- WordPress等のメジャーなCMSの情報はインターネット上に溢れており多くの人が利用しやすい半面、脆弱性情報も広く知られているため、現実でも今回のように攻撃の足がかりにされるケースが多いだろうと感じた。
- 個人でサーバ上に何かを乗せる際はWAF、ファイアウォール、多要素認証設定は必ず行い、定期的にセキュリティアップデートを確認し実施すべきだと考えた。
- 参考書籍について、ハッキングワーク以外にもコマンドやLinuxについての知見が得られたので買って良かったと感じている。
  - まだ読了していないので、今後も読み進めつつ続きを実施しようと思う。
